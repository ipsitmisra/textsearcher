
{% extends "basic.html" %}
{% load static %}

{% block head %}

<script>

$(document).ready( function(){

  $("#search_button").click(function () {
    // event.preventDefault();
    // alert("running")
    var corpus = document.getElementById('corpus').value.replace(/['"]+/g, '');
    var text2scan = document.getElementById('search_box').value;
    var namechecked = 0;
    if ($('#namechecked').is(':checked')){
      namechecked = 1;
    } 
    
    
    $.ajax({
        url: 'scan',
        type: "POST",
        data: { "corpus" : corpus,
                "text2scan" : text2scan,
                "namechecked" : namechecked,
                csrfmiddlewaretoken : $('input[name=csrfmiddlewaretoken]').val()
        },
        dataType: 'json',
  
        success: function (data) {
        
        score = data["score"];
        matched = data["matched"];
        // alert(score + data["score"]);
        // alert(matched)
        if (matched == null){
        document.getElementById("match_found").innerText = "No Match Found" 
      }else{
        document.getElementById("match_found").innerText = "Match Found -    " + matched
      }
        if (namechecked == 1){
        var area   = $('#corpus');
        var i;
        // for (i of matched) {
        //     var findWord = i;
        //     var index = area.val().indexOf(findWord);
        //     area.focus().prop({'selectionStart': index, 'selectionEnd': index+findWord.length})   
        //     }
        var findWord = matched[0];
        var index = area.val().indexOf(findWord);
        area.focus().prop({'selectionStart': index, 'selectionEnd': index+findWord.length})   
        }

        // if(score > 30){
        else {   
        var area   = $('#corpus');
        var findWord = data["matched"];
        var index = area.val().indexOf(findWord);
        area.focus().prop({'selectionStart': index, 'selectionEnd': index+findWord.length})          

          // }
          // else alert(score);

        }
      }//success closed
      });
    });
});


$(document).ready( function(){
$("#submit_file").click(function ()  {
if (!$('#myfile').val()) {
event.preventDefault();
alert('Please Upload File');
}})
});

</script>

{% endblock %}




{% block body %}

<div class="mx-auto bg-light text-center" style="width:30%">
<form method="post" action="{% url 'upload_file' %}" enctype="multipart/form-data">
  {% csrf_token %}
  <label class="form-label" for="customFile"> <p class="text-primary">Choose a file to upload</p></label>
  <input type="file" name="myfile" id="myfile" />
  <button id="submit_file" type="submit" value="Upload" class="btn btn-outline-primary">Upload</button>
</form> 
</div>

<div class="mx-auto bg-light text-center" style="width:40%">
  <h5>Text Searcher Powered by AI (COE, CET)</h5> 
  {% csrf_token %}
<div class="input-group">
  <input id="search_box" type="search" class="form-control rounded" placeholder="Search" aria-label="Search"
    aria-describedby="search-addon" />
  <button id="search_button" type="button" class="btn btn-success">search</button>
</div>
<label class="checkbox-inline-md"><input id="namechecked" type="checkbox" value="">  Searching for a Name</label>
</div>

<br>
<div class="mx-auto bg-light text-center" style="width:90%">
<p class="text-danger" id="match_found" style="margin:0;display:inline;">  </p>
</div>

<div class="mx-auto bg-light text-center" style="width:90%">
  <div class="form-group">
    <label for="comment"><h5>Corpus</h5></label>
    <textarea class="form-control" rows="15" id="corpus">{{file_corpus}}</textarea>
  </div>
</div>





<!-- 
<div id="footer" class="card bg-light text-black">
      <div class="card-body">
        Contact-
<ul >
      <li >
        <h5 class="mb-1">Address: COE-AI, CET, bbsr</h5>
      </li>
</ul>
      </div>
</div> -->

  


<!--
  
<div class="progress">
  <div class="progress-bar progress-bar-striped active" role="progressbar"
  aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width:40%">
    40%
  </div>
</div>
  


<section>
  <textarea id="textarea"></textarea>
  <button id="hgh">Hightlight @twiiter</button>
</section>

<script>
  window.onload = function () {

      var textarea = document.getElementById("textarea");
      var checkError = document.getElementById("hgh");

      checkError.addEventListener("click", function () {

          var index = textarea.innerText.indexOf("@twitter");
          if( index >= 0)
              textarea.setSelectionRange(index, index + 8);
      });
  }

</script> -->






    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  
    
{% endblock %}
